<%- include('./partials/header') %>

<div class="container">
    <h2>Profile</h2>
    <div id="mfaStatus" class="alert alert-info"></div>
    <div id="authSection">
        <h3>Set up Multi-Factor Authentication</h3>
        <form id="reauthForm">
            <div class="mb-3">
                <label for="password" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Reauthenticate</button>
        </form>
    </div>
    <div id="emailVerificationSection" class="d-none">
        <div class="alert alert-warning">
            <h4>Email Verification Required</h4>
            <p>Before you can set up MFA, you need to verify your email address.</p>
            <p>A verification email has been sent to <strong id="userEmail"></strong>.</p>
            <p>After verifying, please refresh this page.</p>
        </div>
        <div class="d-grid">
            <button id="resendVerificationEmailBtn" class="btn btn-primary">Resend Verification Email</button>
        </div>
    </div>
    <div id="setupSection" class="d-none">
        <h3>Set up Multi-Factor Authentication</h3>
        <form id="setupForm">
            <div class="mb-3">
                <label for="phoneNumber" class="form-label">Phone Number</label>
                <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
            </div>
            <div id="recaptcha-container" class="mb-3"></div>
            <button type="submit" class="btn btn-primary">Enable MFA</button>
        </form>
        <div id="mfa-error-message" class="text-danger mt-2"></div>
    </div>
    <div id="verificationSection" class="d-none">
        <h3>Verify SMS Code</h3>
        <form id="verificationForm">
            <div class="mb-3">
                <label for="verificationCode" class="form-label">Verification Code</label>
                <input type="text" class="form-control" id="verificationCode" name="verificationCode" required>
            </div>
            <button type="submit" class="btn btn-primary">Verify Code</button>
        </form>
        <div id="mfa-error-message" class="text-danger mt-2"></div>
    </div>
    <div id="successSection" class="d-none">
        <div class="alert alert-success">
            <h4>MFA Setup Successful</h4>
            <p>Multi-Factor Authentication has been successfully set up.</p>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="/js/firebase-config.js"></script>
<script src="/js/profile.js"></script>

<%- include('./partials/footer') %>